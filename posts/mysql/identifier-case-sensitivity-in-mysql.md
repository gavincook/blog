### 0. 背景
最近几天在倒腾分布式事务相关的东西，其中在测试验证阿里的分布式事务方案GTS时，有一个简要的示例。根据脚本创建了相应的数据库后，运行发现有异常。查看日志提示获取表的元数据异常。这里我们假设我们要操作的表为table_a。数据库中的表名为table_a，日志中提示的是TABLE_A。咋一看也没什么不对，MySQL不是不区分大小写的吗？
*备注：GTS在获取表元数据时，会强制使用表名大写，即使SQL和数据库中是小写。*

### 1. MySQL真的不区分大小写吗
千言万语不如实干一把，来一条SQL测试不就知道了。首先我们准备表结构：

```
CREATE TABLE `test` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `name` varchar(32) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

```

下面我们来尝试执行如下查询SQL：

```
select * from TEST
```

咦，提示：TEST表不存在。把查询语句的表名换成小写的test，执行通过。
（备注：上述测试的数据库环境为Linux）
所以说到这里，MySQL是要区分大小写的了？接着在本地（MAC环境）再测试一次：

```
select * from TEST
```

嗯？执行成功，又不区分大小写了？为什么表现会不一样？

### 2. MySQL标识符大小写区分场景
带着疑问，查阅相关文档，发现：MySQL对部分标识符会可能会区分大小写，只针对于表名，数据库名。而对于：列名，索引名，存储过程、事件、资源组名称是不区分大小写。
那么什么情况下会区分大小写呢？主要由配置参数：`lower_case_table_names`控制。`lower_case_table_names`有如下几种情况：


| lower_case_table_names配置值 | 含义 | 使用该值作为默认值的平台 |
| --- | --- | --- |
| 0 | 表名和数据库名存储和查找都是区分大小写的。和创建时的大小写保持一致。 | Linux/Unix |
| 1 | 表名和数据库名在存储和查找的时候都不区分大小写，存储和查找时会全部转换为小写。 | Windows |
| 2 | 表名和数据库名在存储时区分大小写，和创建时保持一致。但在查找时转换为小写，不区分大小写。 | Mac |

这下就能解释为什么上面我们在两种不同环境下测试，表现不一致的现象了。

### 3. 如何避免大小写区分带来的问题
虽然在不同平台默认表现行为不一致，但终究都是通过参数`lower_case_table_names`来控制。
**第一种方式：**在所有平台下使用配置参数`lower_case_table_names=1`，这样有一个不好之处在于不管我们创建时是不是指定了大小写，最终出来的表名或数据库名都变成了小写。这种方式不会引起大小写问题。
**第二种方式：**使用区分大小写的写法，但这样需要保证SQL中的大小写和数据库中的大小写完全一致，否则可能会出现跨平台问题。
**MySQL SQL写法最佳实践：**所有标识符都使用小写+下划线的规范，这样即使在区分大小写的场景也不会引起任何问题。

另外注意：`lower_case_table_names`参数不能动态设置，需要在MySQL配置文件的mysqld部分进行配置，配置后需要重启服务才能生效。

> 参考资料：[identifier case sensitivity](https://dev.mysql.com/doc/refman/8.0/en/identifier-case-sensitivity.html)

